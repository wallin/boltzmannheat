function Rainbow(){function e(e){if(e.length<2)throw new Error("Rainbow must have two or more colours.");var o=(n-r)/(e.length-1),i=new ColourGradient;i.setGradient(e[0],e[1]),i.setNumberRange(r,r+o),t=[i];for(var u=1;u<e.length-1;u++){var s=new ColourGradient;s.setGradient(e[u],e[u+1]),s.setNumberRange(r+o*u,r+o*(u+1)),t[u]=s}return a=e,this}var t=null,r=0,n=100,a=["ff0000","ffff00","00ff00","0000ff"];e(a),this.setColors=this.setColours,this.setSpectrum=function(){return e(arguments),this},this.setSpectrumByArray=function(t){return e(t),this},this.colourAt=function(e){if(isNaN(e))throw new TypeError(e+" is not a number");if(1===t.length)return t[0].colourAt(e);var a=(n-r)/t.length,o=Math.min(Math.floor((Math.max(e,r)-r)/a),t.length-1);return t[o].colourAt(e)},this.colorAt=this.colourAt,this.setNumberRange=function(t,o){if(!(o>t))throw new RangeError("maxNumber ("+o+") is not greater than minNumber ("+t+")");return r=t,n=o,e(a),this}}function ColourGradient(){function e(e,t,r){var n=e;o>n&&(n=o),n>i&&(n=i);var a=i-o,u=parseInt(t,16),s=parseInt(r,16),l=(s-u)/a,f=Math.round(l*(n-o)+u);return formatHex(f.toString(16))}function t(e){var t=/^#?[0-9a-fA-F]{6}$/i;return t.test(e)}function r(e){if(t(e))return e.substring(e.length-6,e.length);for(var r=[["red","ff0000"],["lime","00ff00"],["blue","0000ff"],["yellow","ffff00"],["orange","ff8000"],["aqua","00ffff"],["fuchsia","ff00ff"],["white","ffffff"],["black","000000"],["gray","808080"],["grey","808080"],["silver","c0c0c0"],["maroon","800000"],["olive","808000"],["green","008000"],["teal","008080"],["navy","000080"],["purple","800080"]],n=0;n<r.length;n++)if(e.toLowerCase()===r[n][0])return r[n][1];throw new Error(e+" is not a valid colour.")}var n="ff0000",a="0000ff",o=0,i=100;this.setGradient=function(e,t){n=r(e),a=r(t)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");o=e,i=t},this.colourAt=function(t){return e(t,n.substring(0,2),a.substring(0,2))+e(t,n.substring(2,4),a.substring(2,4))+e(t,n.substring(4,6),a.substring(4,6))},formatHex=function(e){return 1===e.length?"0"+e:e}}(function(){angular.module("ui.flot",["bm.colour"]).directive("chart",["Colour",function(e){return{restrict:"C",link:function(t,r,n){var a;return a=function(a){var o,i,u,s,l,f,c,h,m,g,v,p;if(a)return f=t.$eval(n.chartOptions),g=t.$eval(n.chartData),m=t.$eval(n.chartParams),o=function(){switch(m.eLevelType.value){case"equidistant":return g.energyLevelMainDiff/2;case"sublevel":return g.energyLevelSubDiff/2}}(),p=10,v=0,l={series:{bars:{show:!0,fill:.7,fillColor:"#"+e.colorAt(g.temperature)}},grid:{hoverable:!0,show:!0},yaxis:{min:0,max:f.ymax,ticks:p,tickLength:v},xaxis:{min:0,max:f.xmax,tickLength:0},bars:{horizontal:!0,barWidth:o,lineWidth:1},tooltip:!0,tooltipOpts:{content:"population at E-level %y.0 is %x.2",shifts:{x:-60,y:25}}},c=function(){var e,t;if(f.relative){for(h=angular.copy(g.probability),s=h[0][0],u=e=0,t=h.length;t>e;u=++e)i=h[u],i[0]>0&&(i[0]/=s);return h}return g.probability}(),$.plot(r,[{data:c}],l)},t.$watch(n.chartData,a),t.$watch(n.chartOptions,a,!0),r.show()}}}])}).call(this),function(){angular.module("bm.colour",[]).service("Colour",[function(){var e,t,r,n,a,o,i;return a=new Rainbow,e="#0FDBFF",t="#0FFF1B",r="#FFEB0F",n="#FF170F",i=0,o=500,a.setSpectrum(e,r,n),a.setNumberRange(i,o),a}])}.call(this),function(){angular.module("bm.distribution",[]).service("Distribution",[function(){var e;return e={},e.energyLevels=function(e){var t,r,n,a,o,i,u,s,l,f,c,h,m,g,v;switch(f=1e4,i=new Array(f),a=new Array(f),o=new Array(f),r=e.eDist,n=e.subEDist,e.eLevelType.value){case"equidistant":for(n=0,s=c=0;f>=0?f>=c:c>=f;s=f>=0?++c:--c)i[s]=s*r,a[s]=1;break;case"sublevels":for(t=0,u=h=0,g=e.numSubLevels;g>0?f>=h:h>=f;u=h+=g){for(l=m=0,v=e.numSubLevels;v>=0?v>=m:m>=v;l=v>=0?++m:--m)i[u+l]=t*r+l*n,a[u+l]=1,o[u+l]=u*r;t++}break;case"rotational":throw"TODO!"}return{energyLevels:i,degeneracy:a,energyLevelMainDiff:r,energyLevelSubDiff:n}},e.boltzmann=function(t,r){var n,a,o,i,u,s,l,f,c,h,m,g,v,p,b,y,d,w,L,x,S,D;if(null==r&&(r={}),a=e.energyLevels(t),m=[],g=0,o=t.temperature,i=0,u=0,h=t.numParticles,0===o)for(m.push([1,0]),g=1,S=a.energyLevels,v=0,d=S.length;d>v;v++)f=S[v],m.push([0,f]);else for(D=a.energyLevels,s=p=0,w=D.length;w>p;s=++p)f=D[s],m.push([a.degeneracy[s]*Math.exp(-a.energyLevels[s]/o),f]),g+=m[s][0];for(s=b=0,L=m.length;L>b;s=++b)l=m[s],l[0]/=g,l[0]>0&&(u+=-l[0]*Math.log(l[0]),i+=l[0]*a.energyLevels[s]);if(r.plotRel)for(c=m[0][0],y=0,x=m.length;x>y;y++)l=m[y],l[0]>0&&(l[0]/=c);return n=8.3145,angular.extend({},a,{probability:m,partitionFun:g,numParticles:h,energyParticle:i,energyTotal:i*n*h/1e3,energyMolar:i*n/1e3,entropyParticle:u,entropyTotal:u*n*h,entropyMolar:u*n,temperature:o})},e}])}.call(this),function(){angular.module("bm.system",["bm.distribution"]).service("System",["$rootScope","Distribution",function(e,t){var r,n;return n=[],r=function(){function r(){this.name="System "+"ABCD".charAt(n.length),this.params={numParticles:1,eLevelType:this.options.eLevelTypes[0],eDist:10,numSubLevels:5,subEDist:10,temperature:103},this.update()}return r.prototype.options={eLevelTypes:[{name:"Equidistant",value:"equidistant"},{name:"Sublevels",value:"sublevels"},{name:"Rotational",value:"rotational"}]},r.prototype.update=function(){return this.result=t.boltzmann(this.params),e.$broadcast("system.update")},r}(),{create:function(){var e;return e=new r,n.push(e),e},all:n}}]).controller("SystemCtrl",["$scope","System",function(e,t){return e.data=[],e.system=t.create(),e.plotOptions={relative:!1,eLevels:!0,xmax:1,ymax:200},e.$watch("system.params",function(){return e.system.update()},!0)}]).controller("HeatFlowCtrl",["$scope","System",function(e,t){var r;return r=function(){return e.total=t.all.reduce(function(e,t){return e.result.entropyTotal+t.result.entropyTotal})},e.$on("system.update",r)}])}.call(this),function(){angular.module("Boltzmann",["ui.bootstrap","ui.flot","bm.system"])}.call(this);