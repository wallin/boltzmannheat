(function(){angular.module("bm.system",["bm.distribution"]).service("System",["$rootScope","Distribution",function(t,e){var r,a;return a={},r=function(){function r(){this.params={numParticles:1,eLevelType:this.options.eLevelTypes[0],eDist:10,numSubLevels:5,subEDist:10,temperature:103},this.update()}return r.prototype.options={eLevelTypes:[{name:"Equidistant",value:"equidistant"},{name:"Sublevels",value:"sublevels"},{name:"Rotational",value:"rotational"}]},r.prototype.update=function(){return this.result=e.boltzmann(this.params),t.$broadcast("system.update")},r.prototype.addEnergy=function(t){var r;if(t+this.result.energyTotal<0)throw"Not enough energy to give";return this.result.energyTotal+=t,r=this.params.temperature+1e3*t/(8.3145*this.params.numParticles),r>0&&(this.params.temperature=r),this.params.temperature=e.newT(this.params.temperature,this.result),this.update()},r}(),{findOrCreate:function(t){return null==a[t]&&(a[t]=new r(t)),a[t]},all:a}}]).controller("SystemCtrl",["$attrs","$scope","System",function(t,e,r){return e.system=r.findOrCreate(t.systemName),e.plotOptions={relative:!1,eLevels:!0,xmax:1,ymax:200},e.$watch("system.params",function(){return e.system.update()},!0)}]).controller("HeatFlowCtrl",["$scope","System",function(t,e){var r;return r=function(){var r,a,n,s;t.total=0,n=e.all,s=[];for(r in n)a=n[r],s.push(t.total+=a.result.entropyTotal);return s},t.$on("system.update",r),t.amount=.05,t.transfer=function(r,a){var n,s;return n=e.all[r],s=e.all[a],n.addEnergy(-1*t.amount),s.addEnergy(t.amount)}}])}).call(this);