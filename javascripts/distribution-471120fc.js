(function(){angular.module("bm.distribution",[]).service("Distribution",[function(){var e;return e={},e.energyLevels=function(e){var r,n,t,a,i,o,l,u,f,s,g,y,v,c,h;switch(s=1e4,o=new Array(s),a=new Array(s),i=new Array(s),n=e.eDist,t=e.subEDist,e.eLevelType.value){case"equidistant":for(t=0,u=g=0;s>=0?s>=g:g>=s;u=s>=0?++g:--g)o[u]=u*n,a[u]=1;break;case"sublevels":for(r=0,l=y=0,c=e.numSubLevels;c>0?s>=y:y>=s;l=y+=c){for(f=v=0,h=e.numSubLevels;h>=0?h>=v:v>=h;f=h>=0?++v:--v)o[l+f]=r*n+f*t,a[l+f]=1,i[l+f]=l*n;r++}break;case"rotational":throw"TODO!"}return{energyLevels:o,degeneracy:a,energyLevelMainDiff:n,energyLevelSubDiff:t}},e.boltzmann=function(r){var n,t,a,i,o,l,u,f,s,g,y,v,c;for(t=e.energyLevels(r),a=r.temperature,i=0,o=0,f=r.numParticles,c=e.partition(a,t),s=c[0],g=c[1],l=y=0,v=s.length;v>y;l=++y)u=s[l],u[0]/=g,u[0]>0&&(o+=-u[0]*Math.log(u[0]),i+=u[0]*t.energyLevels[l]);return n=8.3145,angular.extend({},t,{probability:s,partitionFun:g,numParticles:f,energyParticle:i,energyTotal:i*n*f/1e3,energyMolar:i*n/1e3,entropyParticle:o,entropyTotal:o*n*f,entropyMolar:o*n,temperature:a})},e.partition=function(e,r){var n,t,a,i,o,l,u,f,s,g;if(a=[],i=0,0===e)for(a.push([1,0]),i=1,s=r.energyLevels,o=0,u=s.length;u>o;o++)t=s[o],a.push([0,t]);else for(g=r.energyLevels,n=l=0,f=g.length;f>l;n=++l)t=g[n],a.push([r.degeneracy[n]*Math.exp(-t/e),t]),i+=a[n][0];return[a,i]},e.newEdiff=function(r,n){var t,a,i,o,l,u,f,s;for(s=e.partition(r,n),o=s[0],l=s[1],t=0,a=u=0,f=o.length;f>u;a=++u)i=o[a],i[0]/=l,t+=i[0]*n.energyLevels[a];return n.energyTotal-8.3145*t*n.numParticles/1e3},e.newT=function(r,n){var t,a,i,o,l,u,f,s;if(t=1.5*r,a=.5*r,i=(t+a)/2,l=e.newEdiff(a,n),u=e.newEdiff(t,n),f=e.newEdiff(i,n),!(l>0&&0>u))throw"bug";for(o=0,s=1e3;Math.abs(f)>1e-6;)if(o++,f>0?a=i:t=i,i=(t+a)/2,f=e.newEdiff(i,n),o===s)throw"timeout";return Math.round(i)},e}])}).call(this);