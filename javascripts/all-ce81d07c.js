function Rainbow(){function e(e){if(e.length<2)throw new Error("Rainbow must have two or more colours.");var o=(n-r)/(e.length-1),i=new ColourGradient;i.setGradient(e[0],e[1]),i.setNumberRange(r,r+o),t=[i];for(var u=1;u<e.length-1;u++){var l=new ColourGradient;l.setGradient(e[u],e[u+1]),l.setNumberRange(r+o*u,r+o*(u+1)),t[u]=l}return a=e,this}var t=null,r=0,n=100,a=["ff0000","ffff00","00ff00","0000ff"];e(a),this.setColors=this.setColours,this.setSpectrum=function(){return e(arguments),this},this.setSpectrumByArray=function(t){return e(t),this},this.colourAt=function(e){if(isNaN(e))throw new TypeError(e+" is not a number");if(1===t.length)return t[0].colourAt(e);var a=(n-r)/t.length,o=Math.min(Math.floor((Math.max(e,r)-r)/a),t.length-1);return t[o].colourAt(e)},this.colorAt=this.colourAt,this.setNumberRange=function(t,o){if(!(o>t))throw new RangeError("maxNumber ("+o+") is not greater than minNumber ("+t+")");return r=t,n=o,e(a),this}}function ColourGradient(){function e(e,t,r){var n=e;o>n&&(n=o),n>i&&(n=i);var a=i-o,u=parseInt(t,16),l=parseInt(r,16),s=(l-u)/a,f=Math.round(s*(n-o)+u);return formatHex(f.toString(16))}function t(e){var t=/^#?[0-9a-fA-F]{6}$/i;return t.test(e)}function r(e){if(t(e))return e.substring(e.length-6,e.length);for(var r=[["red","ff0000"],["lime","00ff00"],["blue","0000ff"],["yellow","ffff00"],["orange","ff8000"],["aqua","00ffff"],["fuchsia","ff00ff"],["white","ffffff"],["black","000000"],["gray","808080"],["grey","808080"],["silver","c0c0c0"],["maroon","800000"],["olive","808000"],["green","008000"],["teal","008080"],["navy","000080"],["purple","800080"]],n=0;n<r.length;n++)if(e.toLowerCase()===r[n][0])return r[n][1];throw new Error(e+" is not a valid colour.")}var n="ff0000",a="0000ff",o=0,i=100;this.setGradient=function(e,t){n=r(e),a=r(t)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");o=e,i=t},this.colourAt=function(t){return e(t,n.substring(0,2),a.substring(0,2))+e(t,n.substring(2,4),a.substring(2,4))+e(t,n.substring(4,6),a.substring(4,6))},formatHex=function(e){return 1===e.length?"0"+e:e}}(function(){angular.module("Boltzmann",["ui.bootstrap","ui.flot","ui.router","bm.system"])}).call(this),function(){angular.module("ui.flot",["bm.colour"]).directive("chart",["Colour",function(e){return{restrict:"C",link:function(t,r,n){var a;return a=function(a){var o,i,u,l,s,f,c,h,m,v,g,b;if(a)return f=t.$eval(n.chartOptions),v=t.$eval(n.chartData),m=t.$eval(n.chartParams),o=function(){switch(m.eLevelType.value){case"equidistant":return v.energyLevelMainDiff/2;case"sublevel":return v.energyLevelSubDiff/2}}(),b=10,g=0,s={series:{bars:{show:!0,fill:.7,fillColor:"#"+e.colorAt(v.temperature)}},grid:{hoverable:!0,show:!0},yaxis:{min:0,max:f.ymax,ticks:b,tickLength:g},xaxis:{min:0,max:f.xmax,tickLength:0},bars:{horizontal:!0,barWidth:o,lineWidth:1},tooltip:!0,tooltipOpts:{content:"population at E-level %y.0 is %x.2",shifts:{x:-60,y:25}}},c=function(){var e,t;if(f.relative){for(h=angular.copy(v.probability),l=h[0][0],u=e=0,t=h.length;t>e;u=++e)i=h[u],i[0]>0&&(i[0]/=l);return h}return v.probability}(),$.plot(r,[{data:c}],s)},t.$watch(n.chartData,a),t.$watch(n.chartOptions,a,!0),r.show()}}}])}.call(this),function(){angular.module("bm.colour",[]).service("Colour",[function(){var e,t,r,n,a,o,i;return a=new Rainbow,e="#0FDBFF",t="#0FFF1B",r="#FFEB0F",n="#FF170F",i=0,o=500,a.setSpectrum(e,r,n),a.setNumberRange(i,o),a}])}.call(this),function(){angular.module("bm.distribution",[]).service("Distribution",[function(){var e;return e={},e.energyLevels=function(e){var t,r,n,a,o,i,u,l,s,f,c,h,m,v,g;switch(f=1e4,i=new Array(f),a=new Array(f),o=new Array(f),r=e.eDist,n=e.subEDist,e.eLevelType.value){case"equidistant":for(n=0,l=c=0;f>=0?f>=c:c>=f;l=f>=0?++c:--c)i[l]=l*r,a[l]=1;break;case"sublevels":for(t=0,u=h=0,v=e.numSubLevels;v>0?f>=h:h>=f;u=h+=v){for(s=m=0,g=e.numSubLevels;g>=0?g>=m:m>=g;s=g>=0?++m:--m)i[u+s]=t*r+s*n,a[u+s]=1,o[u+s]=u*r;t++}break;case"rotational":throw"TODO!"}return{energyLevels:i,degeneracy:a,energyLevelMainDiff:r,energyLevelSubDiff:n}},e.boltzmann=function(t,r){var n,a,o,i,u,l,s,f,c,h,m,v,g,b,p,y,d,w,L,x,$,F;if(null==r&&(r={}),a=e.energyLevels(t),m=[],v=0,o=t.temperature,i=0,u=0,h=t.numParticles,0===o)for(m.push([1,0]),v=1,$=a.energyLevels,g=0,d=$.length;d>g;g++)f=$[g],m.push([0,f]);else for(F=a.energyLevels,l=b=0,w=F.length;w>b;l=++b)f=F[l],m.push([a.degeneracy[l]*Math.exp(-a.energyLevels[l]/o),f]),v+=m[l][0];for(l=p=0,L=m.length;L>p;l=++p)s=m[l],s[0]/=v,s[0]>0&&(u+=-s[0]*Math.log(s[0]),i+=s[0]*a.energyLevels[l]);if(r.plotRel)for(c=m[0][0],y=0,x=m.length;x>y;y++)s=m[y],s[0]>0&&(s[0]/=c);return n=8.3145,angular.extend({},a,{probability:m,partitionFun:v,numParticles:h,energyParticle:i,energyTotal:i*n*h/1e3,energyMolar:i*n/1e3,entropyParticle:u,entropyTotal:u*n*h,entropyMolar:u*n,temperature:o})},e}])}.call(this),function(){angular.module("Boltzmann").config(["$stateProvider","$urlRouterProvider",function(e,t){return e.state("introduction",{url:"/introduction",templateUrl:"introduction.html"}).state("lab",{url:"/lab",templateUrl:"lab.html"}),t.otherwise("/lab")}])}.call(this),function(){angular.module("bm.system",["bm.distribution"]).service("System",["$rootScope","Distribution",function(e,t){var r,n;return n={},r=function(){function r(){this.params={numParticles:1,eLevelType:this.options.eLevelTypes[0],eDist:10,numSubLevels:5,subEDist:10,temperature:103},this.update()}return r.prototype.options={eLevelTypes:[{name:"Equidistant",value:"equidistant"},{name:"Sublevels",value:"sublevels"},{name:"Rotational",value:"rotational"}]},r.prototype.update=function(){return this.result=t.boltzmann(this.params),e.$broadcast("system.update")},r}(),{findOrCreate:function(e){return null==n[e]&&(n[e]=new r(e)),n[e]},all:n}}]).controller("SystemCtrl",["$attrs","$scope","System",function(e,t,r){return t.system=r.findOrCreate(e.systemName),t.plotOptions={relative:!1,eLevels:!0,xmax:1,ymax:200},t.$watch("system.params",function(){return t.system.update()},!0)}]).controller("HeatFlowCtrl",["$scope","System",function(e,t){var r;return r=function(){var r,n,a,o;e.total=0,a=t.all,o=[];for(r in a)n=a[r],o.push(e.total+=n.result.entropyTotal);return o},e.$on("system.update",r)}])}.call(this);